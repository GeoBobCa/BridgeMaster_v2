
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="utf-8"><title>{{ hand.facts.board }}</title>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            <style>
                .hand-box { background: #fdfdfd; border: 1px solid #ccc; padding: 10px; border-radius: 5px; font-size: 0.9rem; }
                .suit-symbol { display: inline-block; width: 15px; text-align: center; font-weight: bold; }
                .suit-S { color: black; } .suit-H { color: red; } .suit-D { color: orange; } .suit-C { color: green; }
                .dealer-badge { background-color: #000; color: #fff; padding: 2px 6px; border-radius: 4px; font-size: 0.7em; margin-left: 5px; }
                .dds-make { background-color: #d4edda; color: #155724; font-weight: bold; }
            </style>
        </head>
        <body class="bg-white"><div class="container py-4">
            <div class="d-flex justify-content-between mb-4">
                <a href="index.html" class="btn btn-outline-secondary">&larr; Back</a>
                <div>
                    <h2 class="m-0 d-inline">{{ hand.facts.board }}</h2>
                    <span class="text-muted ms-2 fs-5">({{ hand.facts.source_file }})</span>
                </div>
                <a href="{{ hand.facts.handviewer_url }}" target="_blank" class="btn btn-danger">Replay</a>
            </div>
            
            <div class="row mb-5">
                <div class="col-md-8">
                    <div class="card bg-success bg-opacity-10 border-success h-100">
                        <div class="card-body position-relative" style="min-height: 400px;">
                            <div class="position-absolute top-50 start-50 translate-middle text-center bg-white p-3 border rounded shadow-sm" style="z-index: 2;">
                                <strong>{{ hand.facts.board }}</strong><br>
                                Dlr: {{ hand.facts.dealer }} | Vul: {{ hand.facts.vulnerability }}
                            </div>
                            {% for seat in ['North', 'West', 'East', 'South'] %}
                            {% set pos = 'top-0 start-50 translate-middle-x mt-2 w-50' if seat == 'North' else 'bottom-0 start-50 translate-middle-x mb-2 w-50' if seat == 'South' else 'top-50 start-0 translate-middle-y ms-2 w-25' if seat == 'West' else 'top-50 end-0 translate-middle-y me-2 w-25' %}
                            <div class="position-absolute {{ pos }}">
                                <div class="hand-box shadow-sm">
                                    <strong>{{ seat }}</strong> ({{ hand.facts.hands[seat].name }})
                                    {% if hand.facts.dealer == seat %}<span class="dealer-badge">DLR</span>{% endif %}
                                    <div class="float-end fw-bold">{{ hand.facts.hands[seat].stats.hcp }} HCP</div>
                                    <hr class="my-1">
                                    {% for s in ['S','H','D','C'] %}<div><span class="suit-symbol suit-{{ s }}">{{ {"S":"‚ô†","H":"‚ô•","D":"‚ô¶","C":"‚ô£"}[s] }}</span> {{ hand.facts.hands[seat].stats.cards[s] }}</div>{% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                     <div class="card mb-3">
                        <div class="card-header text-center">
                            <span class="fs-5 fw-bold">{{ hand.facts.result_display }}</span><br>
                            <span class="text-muted small">by {{ hand.facts.declarer_full }}</span>
                        </div>
                     </div>
                     
                     <div class="card border-info">
                        <div class="card-header bg-info text-white">Double Dummy</div>
                        <div class="card-body p-0">
                            {% if hand.dds %}
                            <table class="table table-sm table-bordered mb-0 text-center">
                                <thead class="table-light"><tr><th></th><th>NT</th><th>S</th><th>H</th><th>D</th><th>C</th></tr></thead>
                                <tbody>
                                    {% for seat in ['N', 'S', 'E', 'W'] %}
                                    <tr>
                                        <td><strong>{{ seat }}</strong></td>
                                        {% for strain in ['NT', 'S', 'H', 'D', 'C'] %}
                                            {% set lookup_key = 'N' if strain == 'NT' else strain %}
                                            {% set tricks = hand.dds[seat].get(lookup_key, '-') %}
                                            <td class="{{ 'dds-make' if tricks != '-' and ((strain=='NT' and tricks>=9) or ((strain=='H' or strain=='S') and tricks>=10) or tricks>=11) else '' }}">{{ tricks }}</td>
                                        {% endfor %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <h4 class="section-header">üîç 1. Critique</h4>
            <div class="mb-5">
                {% if hand.ai_analysis.actual_critique %}
                <ul class="list-group">{% for p in hand.ai_analysis.actual_critique %}<li class="list-group-item border-0">üîπ {{ p }}</li>{% endfor %}</ul>
                {% endif %}
            </div>
            
            <h4 class="section-header">üìò 2. Fundamentals</h4>
            <div class="card mb-5 border-primary"><div class="card-body">
                <p class="lead">{{ hand.ai_analysis.basic_section.analysis }}</p>
            </div></div>

            <h4 class="section-header">üéì 3. Coach's Corner</h4>
            <div class="row">
                {% if hand.ai_analysis.coaches_corner %}
                    {% for item in hand.ai_analysis.coaches_corner %}
                    <div class="col-md-6 mb-3"><div class="card bg-light h-100"><div class="card-body">
                        <small class="text-uppercase text-muted">{{ item.player }} | {{ item.category }}</small>
                        <h5 class="card-title">{{ item.topic }}</h5>
                    </div></div></div>
                    {% endfor %}
                {% endif %}
            </div>

        </div></body></html>
        